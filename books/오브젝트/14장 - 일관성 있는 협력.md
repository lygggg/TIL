### 들어가기전에
객체는 협력을 위해 존재한다. 협력은 객체가 존재하는 이유와 문맥을 제공한다. 잘 설계된 애플리케이션은 이해하기 쉽고, 수정이 용이하며, 재사용 가능한 협력의 모임이다.객체지향 설계의 목표는 적절한 책임을 수행하는 객체들의 협력을 기반으로 결합도가 낮고 재사용 가능한 코드 구조를 창조하는 것이다.

애플리케이션을 개발하다 보면 유사한 요구사항을 반복적으로 추가하거나 수정하게 되는 경우가 있다. 이때 객체들의 협력 구조가 서로 다른 경우에는 코드를 이해하기도 어렵고 코드 수정으로 인해 버그가 발생할 위험성도 높아진다. 유사한 요구사항을 계속 추가해야 하는 상황에서 각 협력이 서로 다른 패턴을 다를 경우에는 전체적인 설계의 일관성이 서서히 무너지게 된다.

객체지향 패러다임의 장점은 설계를 재사용할 수 있다는 것이다. 하지만 재사용은 공짜로 얻어지지 않는다. 재사용을 위해서는 객체들의 협력 방식을 일관성 있게 만들어야 한다. 일관성은 설계에 드는 비용을 감소시킨다. 과거의 해결 방법을 반복적으로 사용해서 유사한 기능을 구현하는 데 드는 시간과 노력을 대폭 줄일 수 있기 떄문이다. 일관성 있는 설계가 가져다 주는 더 큰 이익은 코드가 이해하기  쉬워진다는 것이다. 특정한 문제를 유사한 방법으로 해결하고 있다는 사실을 알면 문제를 이해하는 것만으로도 코드의 구조를 예상할 수 있게 된다.

가능하면 유사한 기능을 구현하기 위해 유사한 협력 패턴을 사용하라. 객체들의 협력이 전체적으로 일관성 있는 유사한 패턴을 따른다면 시스템을 이해하고 확장하기 위해 요구되는 정신적인 부담을 크게 줄일 수 있다. 지금 보고 있는 코드가 얼마 전에 봤던 코드와 유사하다는 사실을 아는 순간 새로운 코드가 직관적인 모습으로 다가오는 것을 느끼게 될 것이다. 유사한 기능을 구현하기 위해 유사한 협력 방식을 따를 경우 코드를 이해하기 위해 필요한 것은 약간의 기억력과 적응력뿐이다.

## 설계에 일관성 부여하기
일관성 있는 설계를 만드는 데 가장 중요한 조언은 다양한 설계 경험을 익히는 것이다. 풍부한 설계 경험을 가진 사람은 어떤 변경이 중요한지, 그리고 그 변경을 어떻게 다뤄야 하는지에 대한 통찰력을 가지게 된다. 따라서 설계 경험이 풍부하면 풍부할 수록 어떤 위치에서 일관성을 보장해야 하고 일관성을 제공하기 위해 어떤 방법을 사용해야 하는지 직관적으로 결정할 수 있다.

일관성 있는 설계를 위한 두 번째 조언은 널리 알려진 디자인 패턴을 학습하고 변경이라는 문맥안에서 디자인 패턴을 적용해 보는 것이다. 디자인 패턴은 특정한 변경에 대해 일관성 있는 설계를 만들 수 있는 경험 법칙을 모아놓은 일종의  설계 템플릿이다. 따라서 협력을 일관성 있게 만들기 위해 다음과 같은 기본 지침을 따르는 것이 도움이 될 것이다.
- 변하는 개념을 변하지 않는 개념으로부터 분리하라.
- 변하는 개념을 캡슐화하라.

> 애플리케이션에서 달라지는 부분을 찾고, 달라지지 않는 부분으로 부터 분리시킨다. 이것은 여러 설계 원칙 중에서 첫 번째 원칙이다. 즉, 코드에서 새로운 요구사항이 있을 때마다 바뀌는 부분이 있다면 그 행동을 바뀌지 않는 부분으로부터 골라내서 분리해야한다.
> 
> 즉 "바뀌는 부분을 따로 뽑아서 캡슐화한다. 그렇게 하면 나중에 바뀌지 않는 부분에는 영향을 미치지 않은 채로 그 부분만 고치거나 확장할 수 있다." 

### 협력을 일관성 있게 만들기 위해 따라야 하는 지침
1. 변하는 개념을 변하지 않은 개념으로부터 분리하라.
2. 변하는 개념을 캡슐화하라.

핵심은 훌륭한 추상화를 찾아 추상화에 의존하도록 만드는 것이다. 추상화에 대한 의존은 결합도를 낮추고 결과적으로 대체 가능한 역할로 구성된 협력을 설계할 수 있게 해준다. 따라서 선택하는 추상화의 품질이 캡슐화의 품질을 결정한다.

> 구성 요소를 캡슐화하는 실행 지침은 객체지향의 핵심 덕목 중 하나다. 시스템을 책임을 캡슐화한 섬들로 분리하고 그 섬들 간의 결합도를 제한하라.
> 이 실행 지침이 드러나는 또 다른 주제가 패턴이다. GOF에 의하면 인터페이스에 대해 설계해야 한다고 조언하는데, 이것은 결합도가 느슨해질 수 있도록 엔티티 사이의 관계가 추상적인 수준에서 정해져야 한다는 사실을 다르게 표현할 것이다. 이 특성이 패턴들의 공통적인 경향이라는 것을 알게 될 것이다. 패턴은 매우 빈번하게 요소들이 관계를 맺을 수 있는 대상을 추상적인 기반 타입으로 제한한다.

## 캡슐화 다시 살펴보기
보통 캡슐화라고 생각한다면 `데이터 은닉`을 떠올린다. 데이터 은닉이란 외부에 공개된 메서드를 통해서만 객체의 내부에 접근할 수 있게 제한함으로써 객체 내부의 상태 구현을 숨기는 기법을 가리킨다. `그러나 캡슐화는 데이터 은닉 이상이다.`

GOF의 조언에 따르면 캡슐화란 단순히 데이터를 감추는 것이 아니다. 소프트웨어 안에서 변할 수 있는 모든 개념을 감추는 것이다.

> 캡슐화란 변하는 어떤 것이든 감추는 것이다.

캡슐화의 가장 대표적인 예는 객체의 퍼블릭 인터페이스와 구현을 분리하는 것이다. 객체를 구현한 개발자는 필요할 때 객체의 내부 구현을 수정하기 원한다. 객체와 협력하는 클라이언트의 개발자는 객체의 인터페이스가 변하지 않기를 원한다. 따라서 자주 변경되는 내부 구현을 안정적인 퍼블릭 인터페이스 뒤로 숨겨야 한다.

다시 한번 정리하자면 `캡슐화`란 단순히 데이터를 감추는 것이 아니라, 소프트웨어 안에서 변할 수 있는 어떤 "개념"이라도 감추는 것이다.

### 변경 분리하기
일관성 있는 협력을 만들기 위한 첫 번쨰 단계는 변하는 개념과 변하지 않는 개념을 분리하는 것이다. 아래의 표를 보고 분리해보도록 하자.

| 방식 | 예 | 규칙 |
| --------------------- | ------------------ | ------------------ |
| 고정요금 방식 | 10초당 18원 |  [단위시간]당 [요금]원  |
| 시간대별 방식 | 00시~19시까지 10초당 18원 | [시작시간]~[종료시간]까지 |
| 요일별 방식 | 평일 10초당 38원 | [요일]별 |
| 구간별 방식 | 초기 1분 동안 1분당 50원 | [통화구간]동안 |

먼저 시간대별, 요일별, 구간별 방식의 공통점은 각 기본 정책을 구성하는 방식이 유사하다는 점이다.

- 기본 정책은 한 개 이상의 '규칙'으로 구성된다.
- 하나의 '규칙'은 '적용조건'과 '단위요금'의 조합이다.

시간대별, 요일별, 구간별 방식의 차이점은 각 기본 정책별로 요금을 계산하는 '적용조건'의 형식이 다르다는 것이다. 모든 규칙에 `적용조건`이 포함된다는 사실은 변하지 않지만 실제 조건의 세부적인 내용은 다르다. 시간대별 방식은 통화 시간이 특정 시간 구간에 포함될 경우에만 요금을 계산한다. 요일별 방식은 특정 요일에 해당할 경우에만 요금을 계산한다. 구간별 방식은 통화 시간의 구간이 결과 시간에 포함될 경우에만 요금을 계산한다.

공통점은 변하지 않는 부분이다. 차이점은 변하는 부분이다. 우리의 목적은 변하지 않는 것과 변하는 것을 분리해야하는 것을 기억해야한다.

### 변경 캡슐화하기
협력을 일관성 있게 만들기 위해서는 변경을 캡슐화해서 파급효과를 줄여야 한다. 변경을 캡슐화하는 가장 좋은 방법은 변하지 않는 부분으로부터 변하는 부분을 분리하는 것이다. 물론 변하는 부분의 공통점을 추상화하는 것도 잊어서는 안된다. 이제 변하지 않는 부분이 오직 추상화에만 의존하도록 관계를 제한하면 캡슐화할 수 있게 된다.


## 패턴을 찾아라
일관성있는 협력의 핵심은 변경을 분리하고 캡슐화하는 것이다. 변경을 캡슐화하는 방법이 협력에 참여하는 객체들의 역할과 책임을 결정하고 이렇게 결정된 협력이 코드의 구조를 결정한다. 따라서 훌륭한 설계자가 되는 첫걸음은 변경의 방향을 파악할 수 있는 날카로운 감각을 기르는 것이다. 그리고 이 변경에 탄력적으로 대응할 수 있는 다양한 캡슐화 방법과 설계 방법을 익히는 것 역시 중요하다.

애플리케이션에서 유사한 기능에 대한 변경이 지속적으로 발생하고 있다 변경을 캡슐화할 수 있는 적절한 추상화를 찾은 후, 이 추상화에 변하지 않는 공통적인 책임을 할당하라. 현재의 구조가 변경을 캡슐화하기에 적합하지 않다면 코드를 수정하지 않고도 원하는 변경을 수용할 수 있도록 협력과 코드를 리팩터링하라. 변경을 수용할 수 있는 적절한 역할과 책임을 찾다 보면 협력의 일관성이 서서히 윤곽을 드러낼 것이다.

협력을 일관성 있게 만드는 과정은 유사한 기능을 구현하기 위해 반복적으로 적용할 수 있는 협력의 구조를 찾아가는 기나긴 여정이다. 따라서 협력을 일관성 있게 만든다는 것은 유사한 변경을 수용할 수 있는 협력 패턴을 발견하는 것과 동일하다.

> 객체지향 설계는 객체의 행동과 그것을 지원하기 위한 구조를 계속 수정해 나가는 작업을 반복해 나가면서 다듬어진다. 객체, 역할, 책임은 계속 진화해 나가는 것이다. 협력자들 간에 부하를 좀 더 균형있게 배분하는 방법을 새로 만들어내면 나눠줄 책임이 바뀌게 된다. 만약 객체들이 서로 통신하는 방법을 개선해냈다면 이들 간의 상호작용은 재정의돼야 한다. 이 같은 과정을 거치면서 객체들이 자주 통신하는 경로는 더욱 효율적이게 되고, 주어진 작업을 수행하는 표준 방안이 정착된다. 협력 패턴이 드러나는 것이다.